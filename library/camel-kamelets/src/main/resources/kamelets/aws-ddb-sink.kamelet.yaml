# ---------------------------------------------------------------------------
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ------------------------------------------------------------------------------
apiVersion: "camel.apache.org/v1alpha1"
kind: "Kamelet"
metadata:
  annotations:
    camel.apache.org/kamelet.support.level: "Stable"
    camel.apache.org/catalog.version: "main-SNAPSHOT"
    camel.apache.org/kamelet.icon: "data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjEwMCIgd2lkdGg9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBmaWxsPSIjMkQ3MkI4IiBkPSJNNzQuMTc0IDMxLjgwN2w3LjQzNyA1LjM2N3YtNy42MDJsLTcuNDgtOC43NjV2MTAuOTU3bC4wNDMuMDE1eiIvPjxwYXRoIGZpbGw9IiM1Mjk0Q0YiIGQ9Ik01OS44MzggODUuNjY2bDE0LjI5My03LjE0NlYyMC43OTFsLTE0LjMwMy03LjEyNHoiLz48cGF0aCBmaWxsPSIjMjA1Qjk4IiBkPSJNMzkuNDk2IDg1LjY2NkwyNS4yMDMgNzguNTJWMjAuNzkxbDE0LjMwMy03LjEyNHoiLz48cGF0aCBmaWxsPSIjMkQ3MkI4IiBkPSJNMzkuNTA2IDEzLjY2N2gyMC4zMjF2NzEuOTk5SDM5LjUwNnpNNzQuMTMxIDY3LjU2NFY3OC41Mmw3LjQ4LTguNzY0di03LjYwMmwtNy40MzcgNS4zOTd6TTc0LjEzMSA2Mi45MzZsLjA0My0uMDEgNy40MzctNHYtNy42NDlsLTcuNDguNjg4ek03NC4xNzQgMzYuNDI5bC0uMDQzLS4wMVY0Ny4zNWw3LjQ4LjY5OXYtNy42NDV6Ii8+PHBhdGggZmlsbD0iIzFBNDc2RiIgZD0iTTgxLjYxMSA0OC4wNDlsLTcuNDgtLjY5OS0xNC4zMDMtLjU3MkgzOS41MDZsLTE0LjMwMy41NzJWMzYuNDQzbC0uMDE1LjAwOC4wMTUtLjAzMiAxNC4zMDMtMy4zMTRINTkuODI4bDE0LjMwMyAzLjMxNCA1LjI1OCAyLjc5NXYtMS43OTdsMi4yMjItLjI0My03LjQ4LTUuNDEtMTQuMzAzLTQuNDMySDM5LjUwNmwtMTQuMzAzIDQuNDMyVjIwLjgwN2wtNy40OCA4Ljc2M3Y3LjY1M2wuMDU4LS4wNDIgMi4xNjQuMjM2djEuODM0bC0yLjIyMiAxLjE4OXY3LjYxNWwuMDU4LS4wMDYgMi4xNjQuMDMydjMuMTk2bC0xLjg2Ny4wMjgtLjM1NS0uMDM0djcuNjE4bDIuMjIyIDEuMTk1djEuODU1bC0yLjEyOS4yMzUtLjA5My0uMDd2Ny42NTJsNy40OCA4Ljc2NFY2Ny41NjRsMTQuMzAzIDQuNDMySDU5LjgyOGwxNC4zNDUtNC40NDUgNy40MzgtNS4zNjctMi4yMjItLjI0NXYtMS44MThsLTUuMjE2IDIuODA1LTE0LjM0NSAzLjI5NXYuMDA0SDM5LjUwNnYtLjAwNGwtMTQuMzQ4LTMuMjk1LS4wMjUtLjA1MS4wNy4wMzdWNTEuOTY1bDE0LjMwMy41N3YuMDE0SDU5LjgyOHYtLjAxNGwxNC4zMDMtLjU3IDcuNDgtLjY1Ni0yLjIyMi0uMDMydi0zLjE5NnoiLz48L3N2Zz4="
    camel.apache.org/provider: "Apache Software Foundation"
    camel.apache.org/kamelet.group: "AWS DynamoDB Streams"
  labels:
    camel.apache.org/kamelet.type: "sink"
  name: "aws-ddb-sink"
  headers:
    CamelAwsDdbUpdateCondition: "Designates an attribute for a conditional modification."
    CamelAwsDdbBatchItems: "A map of the table name and corresponding items to get by primary key."
    CamelAwsDdbReturnValues: "Use this parameter if you want to get the attribute name-value pairs before or after they are modified(NONE, ALL_OLD, UPDATED_OLD, ALL_NEW, UPDATED_NEW)."
    CamelAwsDdbScanFilter: "Evaluates the scan results and returns only the desired values."
    CamelAwsDdbUpdateValues: "Map of attribute name to the new value and action for the update."
    CamelAwsDdbItem: "A map of the attributes for the item, and must include the primary key values that define the item."
    CamelAwsDdbLimit: "The maximum number of items to return."
    CamelAwsDdbAttributeNames: "If attribute names are not specified then all attributes will be returned."
    CamelAwsDdbIndexName: "If set will be used as Secondary Index for Query operation."
    CamelAwsDdbKeyConditions: "This header specify the selection criteria for the query, and merge together the two old headers CamelAwsDdbHashKeyValue and CamelAwsDdbScanRangeKeyCondition"
    CamelAwsDdbStartKey: "Primary key of the item from which to continue an earlier query."
    CamelAwsDdbTableName: "Table Name for this operation."
    CamelAwsDdbConsistentRead: "If set to true, then a consistent read is issued, otherwise eventually consistent is used."
    CamelAwsDdbScanIndexForward: "Specifies forward or backward traversal of the index."
    CamelAwsDdbOperation: "The operation to perform."
    CamelAwsDdbKey: "The primary key that uniquely identifies each item in a table."
spec:
  definition:
    description: "Send data to Amazon DynamoDB. The sent data inserts, updates, or deletes an item on the specified AWS DynamoDB table.\n\nThe basic authentication method for the AWS DynamoDB service is to specify an access key and a secret key. These parameters are optional because the Kamelet provides a default credentials provider.\n\nIf you use the default credentials provider, the DynamoDB client loads the credentials through this provider and doesn't use the basic authentication method.\n\nThis Kamelet expects a JSON-formatted body and it must include the primary key values that define the DynamoDB item. The mapping between the JSON fields and table attribute values is done by key. For example, for  '{\"username\":\"oscerd\", \"city\":\"Rome\"}' input, the Kamelet inserts or update an item in the specified AWS DynamoDB table and sets the values for the 'username' and 'city' attributes. "
    properties:
      table:
        description: "The name of the DynamoDB table."
        title: "Table"
        type: "string"
      accessKey:
        description: "The access key obtained from AWS."
        format: "password"
        title: "Access Key"
        type: "string"
        x-descriptors:
         - "urn:alm:descriptor:com.tectonic.ui:password"
         - "urn:camel:group:credentials"
      secretKey:
        description: "The secret key obtained from AWS."
        format: "password"
        title: "Secret Key"
        type: "string"
        x-descriptors:
         - "urn:alm:descriptor:com.tectonic.ui:password"
         - "urn:camel:group:credentials"
      region:
        description: "The AWS region to access."
        enum:
         - "ap-south-1"
         - "eu-south-1"
         - "us-gov-east-1"
         - "me-central-1"
         - "ca-central-1"
         - "eu-central-1"
         - "us-iso-west-1"
         - "us-west-1"
         - "us-west-2"
         - "af-south-1"
         - "eu-north-1"
         - "eu-west-3"
         - "eu-west-2"
         - "eu-west-1"
         - "ap-northeast-3"
         - "ap-northeast-2"
         - "ap-northeast-1"
         - "me-south-1"
         - "sa-east-1"
         - "ap-east-1"
         - "cn-north-1"
         - "us-gov-west-1"
         - "ap-southeast-1"
         - "ap-southeast-2"
         - "us-iso-east-1"
         - "ap-southeast-3"
         - "us-east-1"
         - "us-east-2"
         - "cn-northwest-1"
         - "us-isob-east-1"
         - "aws-global"
         - "aws-cn-global"
         - "aws-us-gov-global"
         - "aws-iso-global"
         - "aws-iso-b-global"
        title: "AWS Region"
        type: "string"
      operation:
        default: "PutItem"
        description: "The operation to perform. The options are PutItem, UpdateItem, or DeleteItem."
        example: "PutItem"
        title: "Operation"
        type: "string"
      writeCapacity:
        default: 1
        description: "The provisioned throughput to reserve for writing resources to your table."
        title: "Write Capacity"
        type: "integer"
      useDefaultCredentialsProvider:
        default: false
        description: "If true, the DynamoDB client loads credentials through a default credentials provider. If false, it uses the basic authentication method (access key and secret key)."
        title: "Default Credentials Provider"
        type: "boolean"
        x-descriptors:
         - "urn:alm:descriptor:com.tectonic.ui:checkbox"
      uriEndpointOverride:
        description: "The overriding endpoint URI. To use this option, you must also select the `overrideEndpoint` option."
        title: "Overwrite Endpoint URI"
        type: "string"
      overrideEndpoint:
        default: false
        description: "Select this option to override the endpoint URI. To use this option, you must also provide a URI for the `uriEndpointOverride` option."
        title: "Endpoint Overwrite"
        type: "boolean"
        x-descriptors:
         - "urn:alm:descriptor:com.tectonic.ui:checkbox"
    required:
     - "table"
     - "region"
    title: "AWS DynamoDB Sink"
    type: "object"
  dependencies:
   - "github:apache.camel-kamelets:camel-kamelets-utils:main-SNAPSHOT"
   - "camel:core"
   - "camel:jackson"
   - "camel:aws2-ddb"
   - "camel:kamelet"
  template:
    from:
      uri: "kamelet:source"
      steps:
       -
        set-property:
          name: "operation"
          constant: "{{operation}}"
       -
        unmarshal:
          json:
            library: "Jackson"
            unmarshalType: "com.fasterxml.jackson.databind.JsonNode"
       -
        bean: "org.apache.camel.kamelets.utils.transform.aws.ddb.JsonToDdbModelConverter"
       -
        to:
          uri: "aws2-ddb:{{table}}"
          parameters:
            secretKey: "{{?secretKey}}"
            accessKey: "{{?accessKey}}"
            region: "{{region}}"
            operation: "{{operation}}"
            writeCapacity: "{{?writeCapacity}}"
            useDefaultCredentialsProvider: "{{useDefaultCredentialsProvider}}"
            uriEndpointOverride: "{{?uriEndpointOverride}}"
            overrideEndpoint: "{{overrideEndpoint}}"
  types:
    in:
      mediaType: "application/json"
