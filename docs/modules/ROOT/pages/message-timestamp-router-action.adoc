// THIS FILE IS AUTOMATICALLY GENERATED: DO NOT EDIT

= image:kamelets/message-timestamp-router-action.svg[] Message Timestamp Router Action

*Provided by: "Apache Software Foundation"*

*Support Level for this Kamelet is: "Preview"*

Update the topic field as a function of the original topic name and the record's timestamp field.

== Configuration Options

The following table summarizes the configuration options available for the `message-timestamp-router-action` Kamelet:
[width="100%",cols="2,^2,3,^2,^2,^3",options="header"]
|===
| Property| Name| Description| Type| Default| Example
| *timestampKeys {empty}* *| Timestamp Keys| Comma separated list of Timestamp keys. The timestamp is taken from the first found field.| string| | 
| timestampFormat| Timestamp Format| Format string for the timestamp that is compatible with java.text.SimpleDateFormat.| string| `"yyyyMMdd"`| 
| timestampKeyFormat| Timestamp Keys Format| Format of the timestamp keys. Possible values are 'timestamp' or any format string for the timestamp that is compatible with java.text.SimpleDateFormat. In case of 'timestamp' the field will be evaluated as milliseconds since 1970, so as a UNIX Timestamp.| string| `"timestamp"`| 
| topicFormat| Topic Format| Format string which can contain '$[topic]' and '$[timestamp]' as placeholders for the topic and timestamp, respectively.| string| `"topic-$[timestamp]"`| 
|===

NOTE: Fields marked with an asterisk ({empty}*) are mandatory.


== Dependencies

At runtime, the `message-timestamp-router-action Kamelet relies upon the presence of the following dependencies:

- github:apache.camel-kamelets:camel-kamelets-utils:main-SNAPSHOT
- camel:jackson
- camel:kamelet
- camel:core 

== Usage

This section describes how you can use the `message-timestamp-router-action`.

=== Knative Action

You can use the `message-timestamp-router-action` Kamelet as an intermediate step in a Knative binding.

.message-timestamp-router-action-binding.yaml
[source,yaml]
----
apiVersion: camel.apache.org/v1alpha1
kind: KameletBinding
metadata:
  name: message-timestamp-router-action-binding
spec:
  source:
    ref:
      kind: Kamelet
      apiVersion: camel.apache.org/v1alpha1
      name: timer-source
    properties:
      message: "Hello"
  steps:
  - ref:
      kind: Kamelet
      apiVersion: camel.apache.org/v1alpha1
      name: message-timestamp-router-action
    properties:
      timestampKeys: "The Timestamp Keys"
  sink:
    ref:
      kind: Channel
      apiVersion: messaging.knative.dev/v1
      name: mychannel

----

==== *Prerequisite*

You have xref:{camel-k-version}@camel-k::installation/installation.adoc[Camel K installed] on the cluster.

==== *Procedure for using the cluster CLI*

. Save the `message-timestamp-router-action-binding.yaml` file to your local drive, and then edit it as needed for your configuration.

. Run the action by using the following command:
+
[source,shell]
----
kubectl apply -f message-timestamp-router-action-binding.yaml
----

==== *Procedure for using the Kamel CLI*

Configure and run the action by using the following command:

[source,shell]
----
kamel bind timer-source?message=Hello --step message-timestamp-router-action -p "step-0.timestampKeys=The Timestamp Keys" channel:mychannel
----

This command creates the KameletBinding in the current namespace on the cluster.

=== Kafka Action

You can use the `message-timestamp-router-action` Kamelet as an intermediate step in a Kafka binding.

.message-timestamp-router-action-binding.yaml
[source,yaml]
----
apiVersion: camel.apache.org/v1alpha1
kind: KameletBinding
metadata:
  name: message-timestamp-router-action-binding
spec:
  source:
    ref:
      kind: Kamelet
      apiVersion: camel.apache.org/v1alpha1
      name: timer-source
    properties:
      message: "Hello"
  steps:
  - ref:
      kind: Kamelet
      apiVersion: camel.apache.org/v1alpha1
      name: message-timestamp-router-action
    properties:
      timestampKeys: "The Timestamp Keys"
  sink:
    ref:
      kind: KafkaTopic
      apiVersion: kafka.strimzi.io/v1beta1
      name: my-topic

----

==== *Prerequisites*

* You've installed https://strimzi.io/[Strimzi].
* You've created a topic named `my-topic` in the current namespace.
* You have xref:{camel-k-version}@camel-k::installation/installation.adoc[Camel K installed] on the cluster.

==== *Procedure for using the cluster CLI*

. Save the `message-timestamp-router-action-binding.yaml` file to your local drive, and then edit it as needed for your configuration.

. Run the action by using the following command:
+
[source,shell]
----
kubectl apply -f message-timestamp-router-action-binding.yaml
----

==== *Procedure for using the Kamel CLI*

Configure and run the action by using the following command:

[source,shell]
----
kamel bind timer-source?message=Hello --step message-timestamp-router-action -p "step-0.timestampKeys=The Timestamp Keys" kafka.strimzi.io/v1beta1:KafkaTopic:my-topic
----

This command creates the KameletBinding in the current namespace on the cluster.

== Kamelet source file

https://github.com/apache/camel-kamelets/blob/main/message-timestamp-router-action.kamelet.yaml

// THIS FILE IS AUTOMATICALLY GENERATED: DO NOT EDIT
